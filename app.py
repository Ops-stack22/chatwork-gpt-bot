from flask import Flask, request, jsonify
import json
import base64
from oauth2client.service_account import ServiceAccountCredentials
import gspread
import openai

# Flaskアプリケーションのインスタンスを作成
app = Flask(__name__)

# Google Sheets APIの設定
GOOGLE_CREDENTIALS_JSON = 'ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAiY2hhdHdvcmstY2hhdGdwdC00MzQ2MDMiLAogICJwcml2YXRlX2tleV9pZCI6ICJiNmY3OTE4YzdhYzFjZmU2ZDcyNWMzZmM4MGQzNmM2MDI1Mjk1NjFhIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUUM4SFQ3S2YvN1g5K2VaXG5mdFFXZjkyOXFOZnNRU29tWjBKNldkU1dmSWVqQmNQUXBuUWxoajIxWStXdG91MDRCOWd6MjMvZmJKQmpkZHlKXG4xSnROWXo4ZFpJUTdBeUhSdDZsN2trN1B4UjM3SGdNRUVIekJlNTROY1hYLy9xOTRVc01ZanN6TkgvbFdHckUwXG4yWTdWZFJSUTAzck9aZ3pGY3Zib0lkbVJDWmhlNmQ3eDl6VmM3OXJyb05oSGhxSVVaSmkzZHE0N0ZYYWJvbFErXG5vVGhjdXJSVmMyTDdMeFpFV0FmZHM1Q2x0SGtqZHJKaEpDcmFXZ2RZemJkSnZqdVozeTB3SjB1YzdBMDY4dyttXG45MU9ZWi85WC9TUWRKdHBYdlpPUmk3VFJBQzZYeDF2cnR6Q2Q3UzFHaXpCOUVYR1pqVUdYQm5uY2dRZEdYOHlLXG5jUG5wMGE3TEFnTUJBQUVDZ2dFQUxlR1NMWkRQWnZ5TGkrZ2ZzWWNwWGJkZlJydlVISDdGKzVLS1k5UG12eS9LXG5SVXM3KytVRWl3ZmMvcDlFN1l3WVF2bXY5QjRHRDRReE1KcmU4QjZiUjc5Njh1dStKV2orMk9saitKQVMwbXROXG5BQUpIYzJlRHNyS3dQYXB3UU5BcXpvUVIxcHdNVStCNXhUS2xBRklvak5ndjFVU1ZxOWp3K01nOHlQL0ducXRQXG5vS0tKa1NmU2dsNnVGTVhTSnluL1RNWGhTbWJxT3JSSjZUUFg5emhmVFdIbkwwUmVMTkdmVWV1cndSamUxM0dBXG4vTi9OelFBamhVYS9VS1BnbGQyS2FwUVRPOVZVbGN2TkpIS1Rua1hKS2M5c3pvNjUzSno1UzJGVXJmcGFqSGhSXG5MZXlWdXIzeVFCdU05YU9NRjgxYTlCcWdibi8rd2w5R3FUQmVkVlVla1FLQmdRRHY0MnhDRWlMRWx4dmFucjliXG5jVytBVTlhL1AxNEF0NXJLK1ltYzFBR0dqdDNhQ0NMYXVvTUY0bTUrRXQrRDJCdjkrUXQ1TmpXc1UrM1psb2s5XG51Uk5tRnFJS1dIYW9lUGF0WWU5V1llNzduQTVlcmZpOVhZN3NQNUU3djc1Mng0UU5aZ2dDK0Z1aDBCUU1QMGRwXG5sNDB4TUQrL0dDVllITzNaYXI3SEhlMkkwUUtCZ1FESXY2RzJrd1JRYUVlVWhLZ3c1VTZwb1NsV2JsUVE3VkZ5XG5LdXMxdVBETzc0NTRsanFoWk9NMENZNUk0THpDZlBUemhJa01ScTgzdlB3TE9kYWQzb1VRa2FjdHh5c05CZEpIXG5zaWhNb3RucTRHSHg1dExSYXl5aERYQWhRL0grQzF6QXc5Z2lzZVhOY2lEZGF1L1MvYWt2RGtvT1k5ZUJDQVVwXG43ZkdEYm14azJ3S0JnUURyRDNSVFFhWWo4Tlh3WVVHcy92aDlUS25PK083SjBSK3k2Tlg1Z0p5R0Y1UTRRMlN6XG40N0xqbno4WjlyQmladTcyN0lSYm44ejBNY0dOUnI3d1psd2wydU9wTTRvQ0I1WGZ5MmxVd2Q0RldxT1NEdkwvXG55NTl5eTg4cU52Y1JPT3VpbldvWVR2aXJGRk93dElqclpQK0xSWFlSY0QyWG03Rk5MQllJMHNDaElRS0JnUUN3XG5EYmVCeVk4NEFTdjlhUldqeEFabnAybjhYY2VtREtxbjZGSGRESE5MMkRWbk5jRDNkK1gxNWdkOWpIS2VVajMwXG5McUNPUHBNOTI2UmpKL2M2L2tKT1ZKNTcvRGFhTmlmREx0QSszWGNsa0dEMVo4d3RVc09SL3BuKzRucWdwRkJVXG4wYXlFU09YVGRpcXlaQzB0S2I2dEFPZ2JsSjRUai9nUFhKaTQvaWRiandLQmdDa2VsRUc1dzZzUW1KSTNZSjNDXG5nb2FLWHdiVldQM250UWpHY2ZVbFZYWHB5c3ZGT0Z4V2k4L2JpWWZORytiTkp2RmdzMXZnVWwwUi9JVjdVT0RXXG5NTms5bmNVSUloTGlXbkxuKzJRNnMzWlhWb3VodDB0alJKcW9mRXhXVENXTTNTcll5TXdIcE9va2tEbGFpcEQ3XG5KSWRYM2o5Rll6SDJqL1d0MGt3NEdNMWRcbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJjaGF0d29yay1ncHRAY2hhdHdvcmstY2hhdGdwdC00MzQ2MDMuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLAogICJjbGllbnRfaWQiOiAiMTExNjI4OTcwNjY4ODk0MTE0NDIwIiwKICAiYXV0aF91cmkiOiAiaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL28vb2F1dGgyL2F1dGgiLAogICJ0b2tlbl91cmkiOiAiaHR0cHM6Ly9vYXV0aDIuZ29vZ2xlYXBpcy5jb20vdG9rZW4iLAogICJhdXRoX3Byb3ZpZGVyX3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YxL2NlcnRzIiwKICAiY2xpZW50X3g1MDlfY2VydF91cmwiOiAiaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vcm9ib3QvdjEvbWV0YWRhdGEveDUwOS9jaGF0d29yay1ncHQlNDBjaGF0d29yay1jaGF0Z3B0LTQzNDYwMy5pYW0uZ3NlcnZpY2VhY2NvdW50LmNvbSIsCiAgInVuaXZlcnNlX2RvbWFpbiI6ICJnb29nbGVhcGlzLmNvbSIKfQo='
SCOPE = ['https://spreadsheets.google.com/feeds', 'https://www.googleapis.com/auth/drive']

# JSONキーをデコードし、Google認証情報をセットアップ
creds_json = json.loads(base64.b64decode(GOOGLE_CREDENTIALS_JSON))
creds = ServiceAccountCredentials.from_json_keyfile_dict(creds_json, SCOPE)
client = gspread.authorize(creds)

# ChatGPTの設定
OPENAI_API_KEY = 'YOUR_OPENAI_API_KEY'
openai.api_key = OPENAI_API_KEY

# ルートエンドポイント
@app.route('/', methods=['GET', 'HEAD'])
def home():
    return 'Hello, this is the home page!', 200

# Chatwork Webhookエンドポイント
@app.route('/webhook', methods=['POST'])
def webhook():
    # Chatworkからのデータを処理
    data = request.json
    # 必要な処理をここで実行
    return jsonify({'status': 'success'}), 200

# アプリケーションのエントリーポイント
if __name__ == '__main__':
    app.run(host='0.0.0.0', port=10000, debug=True)
